#! /usr/bin/env coffee
# --nodejs debug

args = process.argv.slice 2

{parse} = require '../dist/parser'
{eval} = require '../dist/oppo'
fs = require 'fs'

parseFile = (file, cb) ->
  fs.readFile file, 'utf8', (err, data) ->
    if err? or not data?
      console.log "err", err, data
      throw err or new Error "No data came from file #{file}"

    if args[2] is "#t"
      console.log (parse data).toString()
    (cb or ->) eval data
  
  
if args[0] in ["-c", "--compile"]
  parseFile args[1], (result) ->
    console.log result
    
if args[0] in ["-e", "--eval"]
  console.log eval args[1]
  
if args[0] in ["-t", "--tree"]
  console.log "#{parse args[1]}"
  
if args[0] in ["-p", "--profile"]
  start = Date.now()
  result = eval args[1]
  end = Date.now()
  console.log """
  parse tree : #{parse args[1]}
  result     : #{result}
  time (ms)  : #{end - start}
  
  """