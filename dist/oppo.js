// Generated by CoffeeScript 1.3.3
(function() {
  var C, JisonParser, L, Parser, core, name, op, postfix_ops, prefix_ops, regular_ops, root, _fn, _fn1, _fn2, _ref,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  root = typeof global !== "undefined" && global !== null ? global : window;

  root.root = root;

  L = {};

  root.lemur = L;

  core = L.core = {};

  (function() {
    var toString;
    toString = Object.prototype.toString;
    return core.to_type = function(o) {
      var s;
      s = toString.call(o);
      s = s.substring(8, s.length - 1);
      return s.toLowerCase();
    };
  })();

  core.s_trim = (_ref = String.prototype.trim) != null ? _ref : function() {
    return String(this).replace(/^\s+/, '').replace(/\s+$/, '');
  };

  (function() {
    var Noop, _ref1;
    Noop = function() {};
    return core.clone = (_ref1 = Object.create) != null ? _ref1 : function(o) {
      Noop.prototype = o;
      return new Noop();
    };
  })();

  if ((typeof exports !== "undefined" && exports !== null) && (typeof module !== "undefined" && module !== null)) {

  } else if (typeof provide !== "undefined" && provide !== null) {
    provide("lemur", L);
  }

  if ((typeof process !== "undefined" && process !== null ? process.title : void 0) === "node") {
    require('coffee-script');
    L = typeof lemur !== "undefined" && lemur !== null ? lemur : require('../core');
    JisonParser = (require('jison')).Parser;
    Parser = (function(_super) {

      __extends(Parser, _super);

      Parser.prototype.re = {
        lex_return: /^(return|function)/,
        "function": /^function/,
        strip_function: /^function\s*\([\w,]*\)\s*/,
        unwrap_function: /^function\s*\(\)\s*\{\s*return\s*([\s\S]*);\s*\}/,
        whitespace: /\s+/g,
        regex_special: /[\^\$\*\+\?\.\(\)\|\{\}\[\]\\\/]/g,
        comment: /^\/\*.*\*\//,
        jison_special: /\<\<\w+\>\>/
      };

      function Parser(_arg) {
        var alternatives, entry, grammar, lexer, name, operators, rule, _i, _j, _len, _len1;
        lexer = _arg.lexer, operators = _arg.operators, grammar = _arg.grammar, this.start = _arg.start;
        this.lexer = {
          rules: []
        };
        this.grammar = {};
        this.operators = [];
        if (lexer != null) {
          for (_i = 0, _len = lexer.length; _i < _len; _i++) {
            rule = lexer[_i];
            this.lex_rule.apply(this, rule);
          }
        }
        if (operators != null) {
          for (_j = 0, _len1 = operators.length; _j < _len1; _j++) {
            entry = operators[_j];
            this.operator_rule(entry);
          }
        }
        if (grammar != null) {
          for (name in grammar) {
            if (!__hasProp.call(grammar, name)) continue;
            alternatives = grammar[name];
            this.grammar_rule.apply(this, [name].concat(__slice.call(alternatives)));
          }
        }
        this.parser = new JisonParser({
          lex: this.lexer,
          operators: this.operators,
          bnf: this.grammar,
          startSymbol: this.start
        });
      }

      Parser.prototype.lex_rule = function(pattern, ret) {
        var jison_pattern, jison_ret;
        if (L.core.to_type(pattern) === 'regexp') {
          jison_pattern = pattern.source;
        } else if (!this.re.jison_special.test(pattern)) {
          jison_pattern = pattern.replace(this.re.regex_special, "\\$&");
        }
        if (!(ret != null)) {
          jison_ret = pattern;
        }
        if (L.core.to_type(ret) !== 'string') {
          ret = String(ret);
        }
        jison_ret = L.core.s_trim.call(ret);
        if (!this.re.comment.test(jison_ret)) {
          if (!this.re.lex_return.test(jison_ret)) {
            jison_ret = "return '" + jison_ret + "';";
          } else if (this.re.lex_function.test(jison_ret)) {
            jison_ret = jison_ret.replace(this.re.strip_function, '');
          }
        }
        return this.lexer.rules.push([jison_pattern, jison_ret]);
      };

      Parser.prototype.grammar_rule = function() {
        var action, alt, alternatives, jison_action, match, name, options, pattern;
        name = arguments[0], alternatives = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
        return this.grammar[name] = (function() {
          var _i, _len, _results;
          _results = [];
          for (_i = 0, _len = alternatives.length; _i < _len; _i++) {
            alt = alternatives[_i];
            pattern = alt[0], action = alt[1], options = alt[2];
            if (action != null) {
              action = (match = this.re.unwrap_function.exec(action)) ? match[1] : "(" + action + "())";
              jison_action = "$$ = " + action + ";";
            } else {
              jison_action = "$$ = $1;";
            }
            if (name === this.start) {
              jison_action += " return $$;";
            }
            _results.push([pattern, jison_action, options]);
          }
          return _results;
        }).call(this);
      };

      Parser.prototype.operator_rule = function() {
        var op1, ops;
        ops = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        if (ops.length === 1) {
          ops = ops[0];
        }
        if (L.core.to_type(ops) === 'string') {
          ops = ops.split(this.re.whitespace);
        }
        if (ops.length === 2) {
          op1 = ops.pop().split(this.re.whitespace);
          ops = ops.concat(op1);
        }
        return this.operators.push(ops);
      };

      return Parser;

    })(JisonParser);
    L.parser = function(config) {
      return (new Parser(config)).parser;
    };
    if (typeof exports !== "undefined" && exports !== null) {
      if (typeof module !== "undefined" && module !== null) {
        module.exports = L.parser;
      }
    }
  }

  L = lemur;

  C = L.Compiler = (function() {

    function Compiler(config) {
      var _ref1;
      if (config == null) {
        config = {};
      }
      this.predefined = config.predefined, this.parent_context = config.parent_context;
      C.current_context = this;
      this.scope_stack = ((_ref1 = this.parent_context) != null ? _ref1.scope_stack.slice() : void 0) || [];
      this.new_scope();
      this.global_scope = this.current_scope();
    }

    Compiler.prototype.new_scope = function() {
      return this.push_scope(new C.Scope({
        push_to_current: false
      }));
    };

    Compiler.prototype.push_scope = function(scope) {
      this.scope_stack.push(scope);
      return scope;
    };

    Compiler.prototype.pop_scope = function() {
      return this.scope_stack.pop();
    };

    Compiler.prototype.current_scope = function() {
      return this.scope_stack[this.scope_stack.length - 1];
    };

    Compiler.prototype.find_scope_with_var = function(_var) {
      var scope, _i, _len, _ref1;
      _ref1 = this.scope_stack.slice().reverse();
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        scope = _ref1[_i];
        if (scope.var_defined(_var)) {
          return scope;
        }
      }
      return null;
    };

    Compiler.prototype.get_var_val = function(_var) {
      var scope;
      scope = this.find_scope_with_var(_var);
      if (scope != null) {
        return scope.get_val(_var);
      }
    };

    Compiler.prototype.set_var_val = function(_var, val) {
      var scope;
      scope = this.find_scope_with_var(_var);
      if (scope != null) {
        return scope.set_var(_var, val);
      } else {
        return _var.error_cant_set();
      }
    };

    Compiler.prototype.compile = function(fn) {
      return fn.call(this);
    };

    Compiler.current_scope = function() {
      return this.current_context.current_scope();
    };

    Compiler.push_scope = function() {
      var _ref1;
      return (_ref1 = this.current_context).push_scope.apply(_ref1, arguments);
    };

    Compiler.pop_scope = function() {
      return this.current_context.pop_scope();
    };

    Compiler.new_scope = function() {
      var _ref1;
      return (_ref1 = this.current_context).new_scope.apply(_ref1, arguments);
    };

    Compiler.find_scope_with_var = function() {
      var _ref1;
      return (_ref1 = this.current_context).find_scope_with_var.apply(_ref1, arguments);
    };

    Compiler.get_var_val = function() {
      var _ref1;
      return (_ref1 = this.current_context).get_var_val.apply(_ref1, arguments);
    };

    Compiler.set_var_val = function() {
      var _ref1;
      return (_ref1 = this.current_context).set_var_val.apply(_ref1, arguments);
    };

    return Compiler;

  })();

  C.Construct = (function() {
    var Noop;

    function Construct(value, yy_or_node_or_num) {
      var _ref1;
      this.value = value;
      if (yy_or_node_or_num instanceof Construct) {
        this.transfer_node = yy_or_node_or_num;
        this.yy = yy_or_node_or_num.yy;
      } else if ((L.core.to_type(yy_or_node_or_num)) === "number") {
        this.yy = {
          lexer: {
            yylineno: yy_or_node_or_num
          }
        };
      } else {
        this.yy = yy_or_node_or_num;
      }
      this.line_number = (_ref1 = this.yy) != null ? _ref1.lexer.yylineno : void 0;
    }

    Construct.prototype.compile = function() {
      if (this.value != null) {
        return "" + this.value;
      } else {
        return "null";
      }
    };

    Construct.prototype._compile = function() {
      return this.compile.apply(this, arguments);
    };

    Construct.prototype.error = function(message) {
      var filename, location, type;
      filename = C.current_filename;
      location = "";
      type = "";
      if (filename != null) {
        location += " in " + filename;
      }
      if (this.line_number != null) {
        location += " at line " + this.line_number;
      }
      if (this.constructor.name != null) {
        type = "" + this.constructor.name;
      }
      throw "" + type + "Error" + location + ": " + message;
    };

    Construct.prototype.should_return = function() {
      return new C.ReturnedConstruct(this, this.yy);
    };

    Construct.prototype.Noop = Noop = (function() {

      function Noop(c) {
        this.constructor = c;
      }

      return Noop;

    })();

    Construct.prototype.clone = function() {
      var Class, cl, np, p, prop, val, _ref1;
      Class = this.constructor;
      p = Class.prototype;
      np = this.Noop.prototype;
      this.Noop.prototype = p;
      cl = new Noop(Class);
      this.Noop.prototype = np;
      for (prop in this) {
        if (!__hasProp.call(this, prop)) continue;
        val = this[prop];
        val = (_ref1 = val != null ? typeof val.clone === "function" ? val.clone() : void 0 : void 0) != null ? _ref1 : val;
        cl[prop] = val;
      }
      return cl;
    };

    return Construct;

  })();

  C.ReturnedConstruct = (function(_super) {

    __extends(ReturnedConstruct, _super);

    function ReturnedConstruct() {
      return ReturnedConstruct.__super__.constructor.apply(this, arguments);
    }

    ReturnedConstruct.prototype.compile = function() {
      var c_value;
      c_value = this.value._compile();
      if (!this.disabled) {
        return "return " + c_value;
      } else {
        return c_value;
      }
    };

    ReturnedConstruct.prototype.tail_node = function(node) {
      if (!(node != null)) {
        return this;
      } else {
        if (node instanceof C.ReturnedConstruct) {
          node = node.value;
        }
        this.value = node;
        return node.returnedConstruct = this;
      }
    };

    ReturnedConstruct.prototype.should_return = function() {
      return this;
    };

    return ReturnedConstruct;

  })(C.Construct);

  C.Array = (function(_super) {

    __extends(Array, _super);

    function Array(items) {
      this.items = items;
      Array.__super__.constructor.apply(this, arguments);
    }

    Array.prototype.compile = function() {
      var c_items, item;
      c_items = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.items;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          item = _ref1[_i];
          _results.push(item._compile());
        }
        return _results;
      }).call(this);
      return "[" + (c_items.join(', ')) + "]";
    };

    return Array;

  })(C.Construct);

  C.Atom = (function(_super) {

    __extends(Atom, _super);

    function Atom(y, yy) {
      Atom.__super__.constructor.call(this, null, y || yy);
    }

    return Atom;

  })(C.Construct);

  C.Null = (function(_super) {

    __extends(Null, _super);

    function Null() {
      return Null.__super__.constructor.apply(this, arguments);
    }

    Null.prototype.compile = function() {
      return "null";
    };

    return Null;

  })(C.Atom);

  C.Undefined = (function(_super) {

    __extends(Undefined, _super);

    function Undefined() {
      return Undefined.__super__.constructor.apply(this, arguments);
    }

    Undefined.prototype.compile = function() {
      return "void(0)";
    };

    return Undefined;

  })(C.Atom);

  C.Boolean = (function(_super) {

    __extends(Boolean, _super);

    function Boolean() {
      return Boolean.__super__.constructor.apply(this, arguments);
    }

    return Boolean;

  })(C.Atom);

  C.True = (function(_super) {

    __extends(True, _super);

    function True() {
      return True.__super__.constructor.apply(this, arguments);
    }

    True.prototype.compile = function() {
      return "true";
    };

    return True;

  })(C.Boolean);

  C.False = (function(_super) {

    __extends(False, _super);

    function False() {
      return False.__super__.constructor.apply(this, arguments);
    }

    False.prototype.compile = function() {
      return "false";
    };

    return False;

  })(C.Boolean);

  C.This = (function(_super) {

    __extends(This, _super);

    function This() {
      return This.__super__.constructor.apply(this, arguments);
    }

    This.prototype.compile = function() {
      return "this";
    };

    return This;

  })(C.Construct);

  C.Class = (function(_super) {

    __extends(Class, _super);

    Class.prototype.anon_id = 0;

    function Class(config, yy) {
      var constructor, _ref1, _ref2, _ref3;
      if (config == null) {
        config = {};
      }
      Class.__super__.constructor.apply(this, arguments);
      if (!config.hasOwnProperty('constructor')) {
        config.constructor = null;
      }
      this.name = config.name, constructor = config.constructor, this.prototype = config.prototype, this.statics = config.statics;
      if ((_ref1 = this.name) == null) {
        this.name = new C.String("Anonymous_$" + (id++) + "_");
      }
      this.class_constructor = constructor != null ? constructor : new C.Function({}, yy);
      if ((_ref2 = this.prototype) == null) {
        this.prototype = new C.Object([], yy);
      }
      if ((_ref3 = this.statics) == null) {
        this.statics = new C.Object([], yy);
      }
      this.class_constructor.name = this.name;
    }

    Class.prototype.object_compile = function(prefix, obj) {
      var pairs, prop, val;
      pairs = (function() {
        var _i, _len, _ref1, _ref2, _results;
        _ref1 = obj.property_value_pairs;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          _ref2 = _ref1[_i], prop = _ref2[0], val = _ref2[1];
          _results.push("" + prefix + "." + (prop._compile()) + " = " + (val._compile()));
        }
        return _results;
      })();
      return pairs.join(';\n  ');
    };

    Class.prototype.compile = function() {
      var proto, statics;
      statics = object_compile(this.name, this.statics);
      proto = object_compile("" + this.name + ".prototype", this.prototype);
      return "" + this.name + " = (function () {\n  " + (this.class_constructor._compile()) + ";\n  " + statics + ";\n  " + proto + ";\n  return " + this.name + ";\n})()";
    };

    return Class;

  })(C.Construct);

  C.CodeFragment = (function(_super) {

    __extends(CodeFragment, _super);

    function CodeFragment(statements) {
      this.statements = statements;
      CodeFragment.__super__.constructor.apply(this, arguments);
    }

    CodeFragment.prototype.compile = function() {
      var c_statements, stmt;
      c_statements = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.statements;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          stmt = _ref1[_i];
          _results.push(stmt.compile());
        }
        return _results;
      }).call(this);
      return "" + (c_statements.join(';\n'));
    };

    return CodeFragment;

  })(C.Construct);

  C.CommaGroup = (function(_super) {

    __extends(CommaGroup, _super);

    function CommaGroup(items) {
      this.items = items;
      CommaGroup.__super__.constructor.apply(this, arguments);
    }

    CommaGroup.prototype.compile = function() {
      var c_items, item;
      c_items = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.items;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          item = _ref1[_i];
          _results.push(item._compile());
        }
        return _results;
      }).call(this);
      return "(" + (c_items.join(', ')) + ")";
    };

    return CommaGroup;

  })(C.Construct);

  C.Function = (function(_super) {

    __extends(Function, _super);

    function Function(_arg) {
      var _ref1, _ref2, _ref3;
      this.name = _arg.name, this.args = _arg.args, this.body = _arg.body, this.autoreturn = _arg.autoreturn;
      if ((_ref1 = this.name) == null) {
        this.name = '';
      }
      if ((_ref2 = this.args) == null) {
        this.args = [];
      }
      if ((_ref3 = this.body) == null) {
        this.body = [];
      }
      Function.__super__.constructor.apply(this, arguments);
      if (this.args instanceof C.Array) {
        this.args = this.args.items;
      }
    }

    Function.prototype.compile = function() {
      var arg, arg_redefs, body, c_args, c_body, c_name, fake_arg, fake_arg_defs, fake_args, fake_fn_call, fn, i, result, ret, scope, stmt, sym_continue, sym_fn, sym_result, tail_recursive, to_return, to_return_context, var_stmt, _continuef, _continuet, _i, _len, _ref1, _ref2, _while;
      scope = new C.Scope();
      _ref1 = this.will_autoreturn(), to_return = _ref1.to_return, to_return_context = _ref1.to_return_context;
      tail_recursive = this.autoreturn && to_return.value instanceof C.FunctionCall && to_return.value.fn instanceof C.Symbol && to_return.value.fn.name === this.name.name;
      body = this.body;
      if (tail_recursive) {
        sym_continue = C.Var.gensym("continue");
        fake_args = {};
        fake_arg_defs = [];
        arg_redefs = [];
        _ref2 = this.args;
        for (i = _i = 0, _len = _ref2.length; _i < _len; i = ++_i) {
          arg = _ref2[i];
          fake_arg = fake_args[arg.name] = C.Var.gensym(arg);
          fake_arg_defs.push(new C.Var.Set({
            _var: fake_arg,
            value: to_return.value.args[i]
          }));
          arg_redefs.push(new C.Var.Set({
            _var: arg,
            value: fake_arg,
            must_exist: false
          }));
        }
        _continuet = new C.Var.Set({
          _var: sym_continue,
          value: new C.True()
        });
        _continuef = new C.Var.Set({
          _var: sym_continue,
          value: new C.False()
        });
        fake_fn_call = new C.CodeFragment(fake_arg_defs.concat(arg_redefs, _continuet));
        body.unshift(_continuef);
        to_return.return_disabled = true;
        to_return_context.tail_node(fake_fn_call);
        fake_fn_call.returnedConstruct.disabled = true;
        sym_result = C.Var.gensym("result");
        sym_fn = C.Var.gensym("fn");
        fn = new C.Var.Set({
          _var: sym_fn,
          value: new C.Function({
            body: body
          })
        });
        result = new C.Var.Set({
          _var: sym_result,
          value: new C.FunctionCall({
            fn: sym_fn,
            scope: new C.This()
          })
        });
        ret = new C.If({
          condition: new C.Not(sym_continue),
          then: new C.ReturnedConstruct(sym_result)
        });
        _while = new C.WhileLoop({
          condition: new C.True(),
          body: [result, ret]
        });
        body = [fn, _while];
      }
      c_name = L.core.to_type(this.name) === "string" ? this.name : this.name._compile();
      c_args = (function() {
        var _j, _len1, _ref3, _results;
        _ref3 = this.args;
        _results = [];
        for (_j = 0, _len1 = _ref3.length; _j < _len1; _j++) {
          arg = _ref3[_j];
          _results.push(arg._compile());
        }
        return _results;
      }).call(this);
      c_body = (function() {
        var _j, _len1, _results;
        _results = [];
        for (i = _j = 0, _len1 = body.length; _j < _len1; i = ++_j) {
          stmt = body[i];
          _results.push(stmt._compile());
        }
        return _results;
      })();
      var_stmt = scope.var_stmt();
      return "function " + c_name + "(" + (c_args.join(", ")) + ") {\n  " + var_stmt + (c_body.join(";\n  ")) + ";\n}";
    };

    Function.prototype.will_autoreturn = function() {
      var ret, to_return;
      if (this.autoreturn) {
        to_return = this.body.pop();
        to_return = to_return.should_return();
        this.body.push(to_return);
        ret = {
          to_return: to_return.tail_node(),
          to_return_context: to_return
        };
      }
      return ret || {};
    };

    return Function;

  })(C.Construct);

  C.FunctionCall = (function(_super) {

    __extends(FunctionCall, _super);

    function FunctionCall(_arg, yy) {
      var _ref1;
      this.fn = _arg.fn, this.args = _arg.args, this.scope = _arg.scope, this.apply = _arg.apply;
      this.call = !!this.scope;
      if ((_ref1 = this.scope) == null) {
        this.scope = new C.Null(null, yy);
      }
      this.args || (this.args = []);
    }

    FunctionCall.prototype.compile = function() {
      var arg, args, c_args, c_fn;
      c_fn = this.fn._compile();
      if (!(this.fn instanceof C.Symbol)) {
        c_fn = "(" + c_fn + ")";
      }
      if (this.apply || this.call) {
        args = [this.scope].concat(this.args);
      } else {
        args = this.args;
      }
      c_args = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = args.length; _i < _len; _i++) {
          arg = args[_i];
          _results.push(arg._compile());
        }
        return _results;
      })();
      return "" + c_fn + (this.apply ? '.apply' : this.call ? '.call' : '') + "(" + (c_args.join(', ')) + ")";
    };

    return FunctionCall;

  })(C.Construct);

  C.If = (function(_super) {

    __extends(If, _super);

    function If(_arg) {
      this.condition = _arg.condition, this.then = _arg.then, this._else = _arg._else;
      If.__super__.constructor.apply(this, arguments);
    }

    If.prototype.compile = function() {
      var c_cond, c_else, c_then, ret;
      c_cond = this.condition.compile();
      c_then = this.then.compile();
      ret = "if (" + c_cond + ") {\n  " + c_then + "\n}";
      if (this._else) {
        c_else = this._else.compile();
        ret = "" + ret + " else {\n  " + c_else + "\n}";
      }
      return ret;
    };

    If.prototype.should_return = function() {
      this.then = this.then.should_return();
      if (this._else) {
        this._else = this._else.should_return();
      }
      return this;
    };

    If.prototype.tail_node = function() {
      var _ref1, _ref2;
      if (this._else != null) {
        return (_ref1 = this._else).tail_node.apply(_ref1, arguments);
      } else {
        return (_ref2 = this.then).tail_node.apply(_ref2, arguments);
      }
    };

    return If;

  })(C.Construct);

  C.Loop = (function(_super) {

    __extends(Loop, _super);

    function Loop() {
      return Loop.__super__.constructor.apply(this, arguments);
    }

    Loop.BREAK = {
      compile: function() {
        return "break";
      }
    };

    Loop.CONTINUE = {
      compile: function() {
        return "continue";
      }
    };

    return Loop;

  })(C.Construct);

  C.ForLoop = (function(_super) {

    __extends(ForLoop, _super);

    function ForLoop(_arg) {
      var condition;
      condition = _arg.condition, this.body = _arg.body;
      this.a = condition[0], this.b = condition[1], this.c = condition[2];
      ForLoop.__super__.constructor.apply(this, arguments);
    }

    ForLoop.prototype.compile = function() {
      var c_a, c_b, c_body, c_c, item;
      c_a = this.a._compile();
      c_b = this.b._compile();
      c_c = this.c._compile();
      c_body = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.body;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          item = _ref1[_i];
          _results.push(item._compile());
        }
        return _results;
      }).call(this);
      return "for (" + c_a + "; " + c_b + "; " + c_c + ") {\n	" + (c_body.join(';\n  ')) + ";\n}";
    };

    return ForLoop;

  })(C.Loop);

  C.ForEachLoop = (function(_super) {

    __extends(ForEachLoop, _super);

    function ForEachLoop(_arg, yy) {
      var a, b, c, i, len, vlen;
      this.collection = _arg.collection, this.body = _arg.body;
      i = C.Var.gensym("i", yy);
      vlen = C.Var.gensym("len", yy);
      len = new C.PropertyAccess([this.collection, C.Symbol("length")]);
      a = new C.Comma(C.Var.Set({
        "var": i,
        value: C.Number(0, yy)
      }), C.Var.Set({
        "var": vlen,
        value: len
      }));
      b = new C.LT([i, len]);
      c = new C.PostIncr(i);
      ForEachLoop.__super__.constructor.call(this, [a, b, c], yy);
    }

    return ForEachLoop;

  })(C.ForLoop);

  C.ForInLoop = (function(_super) {

    __extends(ForInLoop, _super);

    function ForInLoop(_arg) {
      this.property = _arg.property, this.object = _arg.object, this.body = _arg.body;
      ForInLoop.__super__.constructor.apply(this, arguments);
    }

    ForInLoop.prototype.compile = function() {
      var c_body, c_object, c_property, item;
      c_property = this.property._compile();
      c_object = this.object._compile();
      c_body = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.body;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          item = _ref1[_i];
          _results.push(item._compile());
        }
        return _results;
      }).call(this);
      return "for (" + c_property + " in " + c_object + ") {\n  " + (c_body.join(';\n  ')) + ";\n}";
    };

    return ForInLoop;

  })(C.Loop);

  C.WhileLoop = (function(_super) {

    __extends(WhileLoop, _super);

    function WhileLoop(_arg) {
      this.condition = _arg.condition, this.body = _arg.body;
      WhileLoop.__super__.constructor.apply(this, arguments);
    }

    WhileLoop.prototype.compile = function() {
      var c_body, c_condition, item;
      c_condition = this.condition._compile();
      c_body = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.body;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          item = _ref1[_i];
          _results.push(item._compile());
        }
        return _results;
      }).call(this);
      return "while (" + c_condition + ") {\n  " + (c_body.join(';\n  ')) + ";\n}";
    };

    return WhileLoop;

  })(C.Loop);

  C.DoWhileLoop = (function(_super) {

    __extends(DoWhileLoop, _super);

    function DoWhileLoop(_arg) {
      this.condition = _arg.condition, this.body = _arg.body;
      DoWhileLoop.__super__.constructor.apply(this, arguments);
    }

    DoWhileLoop.prototype.compile = function() {
      var c_body, c_condition, item;
      c_condition = this.condition._compile();
      c_body = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = this.body;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          item = _ref1[_i];
          _results.push(item._compile());
        }
        return _results;
      }).call(this);
      return "do {\n  " + (c_body.join(';\n  ')) + ";\n} while (" + c_condition + ")";
    };

    return DoWhileLoop;

  })(C.Loop);

  C.Number = (function(_super) {

    __extends(Number, _super);

    function Number(n) {
      var base, o, value;
      Number.__super__.constructor.apply(this, arguments);
      if ((L.core.to_type(n)) === "object") {
        o = n;
        value = o.value, base = o.base;
        if (base) {
          n = parseInt(value, base);
        } else {
          n = value;
        }
      }
      this.value = +n;
    }

    Number.prototype.compile = function() {
      return "" + this.value;
    };

    return Number;

  })(C.Construct);

  C.Object = (function(_super) {

    __extends(Object, _super);

    function Object(property_value_pairs) {
      this.property_value_pairs = property_value_pairs != null ? property_value_pairs : [];
      Object.__super__.constructor.apply(this, arguments);
    }

    Object.prototype.compile = function() {
      var pairs, prop, val;
      pairs = (function() {
        var _i, _len, _ref1, _ref2, _results;
        _ref1 = this.property_value_pairs;
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          _ref2 = _ref1[_i], prop = _ref2[0], val = _ref2[1];
          _results.push("" + (prop._compile()) + ": " + (val._compile()));
        }
        return _results;
      }).call(this);
      return "{ " + (pairs.join(',\n  ')) + " }";
    };

    return Object;

  })(C.Construct);

  C.ProperyAccess = (function(_super) {

    __extends(ProperyAccess, _super);

    function ProperyAccess(_arg) {
      this.obj = _arg[0], this.props = 2 <= _arg.length ? __slice.call(_arg, 1) : [];
      ProperyAccess.__super__.constructor.apply(this, arguments);
    }

    ProperyAccess.prototype.compile = function() {
      var base, c_prop, prop, _i, _len, _ref1, _results;
      base = this.obj._compile();
      _ref1 = this.props;
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        prop = _ref1[_i];
        c_prop = prop._compile();
        if (prop instanceof C.Var) {
          _results.push(base = "" + base + "." + c_prop);
        } else {
          _results.push(base = "" + base + "[" + c_prop + "]");
        }
      }
      return _results;
    };

    return ProperyAccess;

  })(C.Construct);

  C.Operation = (function(_super) {

    __extends(Operation, _super);

    function Operation(_arg) {
      this.x = _arg[0], this.op = _arg[1], this.y = _arg[2];
      Operation.__super__.constructor.apply(this, arguments);
    }

    Operation.prototype.compile = function() {
      var c_x, c_y;
      c_x = this.x._compile();
      c_y = this.y._compile();
      return "" + c_x + " " + this.op + " " + c_y;
    };

    return Operation;

  })(C.Construct);

  C.PrefixOperation = (function(_super) {

    __extends(PrefixOperation, _super);

    function PrefixOperation(_arg) {
      this.x = _arg[0], this.op = _arg[1];
      PrefixOperation.__super__.constructor.apply(this, arguments);
    }

    PrefixOperation.prototype.compile = function() {
      var c_x;
      c_x = this.x._compile();
      return "" + this.op + c_x;
    };

    return PrefixOperation;

  })(C.Operation);

  C.PostfixOperation = (function(_super) {

    __extends(PostfixOperation, _super);

    function PostfixOperation(_arg) {
      this.x = _arg[0], this.op = _arg[1];
      PostfixOperation.__super__.constructor.apply(this, arguments);
    }

    PostfixOperation.prototype.compile = function() {
      var c_x;
      c_x = this.x._compile();
      return "" + c_x + this.op;
    };

    return PostfixOperation;

  })(C.Operation);

  regular_ops = {
    Add: "+",
    Subtract: "-",
    Multiply: "*",
    Divide: "/",
    Mod: "%",
    GT: ">",
    LT: "<",
    GTE: ">=",
    LTE: "<=",
    Eq3: "===",
    Eq2: "==",
    NotEq3: "!==",
    NotEq2: "!=",
    And: "&&",
    Or: "||",
    BAnd: "&",
    BOr: "|",
    BXor: "^",
    BLeftShift: "<<",
    BRightShift: ">>",
    BZeroFillRightShift: ">>>",
    Comma: ","
  };

  prefix_ops = {
    Not: "!",
    BNot: "~",
    PreIncr: "++",
    PreDecr: "--",
    Delete: "delete "
  };

  postfix_ops = {
    PostIncr: "++",
    PostDecr: "--"
  };

  _fn = function(name, op) {
    return C[name] = (function(_super) {

      __extends(_Class, _super);

      function _Class(_arg, yy) {
        var x, y;
        x = _arg[0], y = _arg[1];
        _Class.__super__.constructor.call(this, [x, op, y], yy);
      }

      return _Class;

    })(C.Operation);
  };
  for (name in regular_ops) {
    if (!__hasProp.call(regular_ops, name)) continue;
    op = regular_ops[name];
    _fn(name, op);
  }

  _fn1 = function(name, op) {
    return C[name] = (function(_super) {

      __extends(_Class, _super);

      function _Class(x, yy) {
        _Class.__super__.constructor.call(this, [x, op], yy);
      }

      return _Class;

    })(C.PrefixOperation);
  };
  for (name in prefix_ops) {
    if (!__hasProp.call(prefix_ops, name)) continue;
    op = prefix_ops[name];
    _fn1(name, op);
  }

  _fn2 = function(name, op) {
    return C[name] = (function(_super) {

      __extends(_Class, _super);

      function _Class(x, yy) {
        _Class.__super__.constructor.call(this, [x, op], yy);
      }

      return _Class;

    })(C.PostfixOperation);
  };
  for (name in postfix_ops) {
    if (!__hasProp.call(postfix_ops, name)) continue;
    op = postfix_ops[name];
    _fn2(name, op);
  }

  C.Raw = (function(_super) {

    __extends(Raw, _super);

    function Raw(text) {
      this.text = text;
      Raw.__super__.constructor.apply(this, arguments);
    }

    Raw.prototype.compile = function() {
      return this.text;
    };

    return Raw;

  })(C.Construct);

  C.Regex = (function(_super) {

    __extends(Regex, _super);

    function Regex(_arg) {
      this.pattern = _arg.pattern, this.modifiers = _arg.modifiers;
      Regex.__super__.constructor.apply(this, arguments);
    }

    Regex.prototype.compile = function() {
      var _ref1;
      return "/" + this.pattern + "/" + ((_ref1 = this.modifiers) != null ? _ref1 : '');
    };

    return Regex;

  })(C.Construct);

  C.Scope = (function() {

    function Scope(config) {
      var push_to_current;
      if (config == null) {
        config = {};
      }
      push_to_current = config.push_to_current;
      this.last_scope = C.current_scope();
      this.vars = {};
      if (push_to_current == null) {
        push_to_current = true;
      }
      if (push_to_current) {
        C.push_scope(this);
      }
    }

    Scope.prototype.def_var = function(_var, val) {
      if (this.var_defined(_var)) {
        _var.error_cant_redefine();
      }
      return this.vars[_var.name] = {
        _var: _var,
        val: val
      };
    };

    Scope.prototype.var_defined = function(_var) {
      return _var.name in this.vars;
    };

    Scope.prototype.set_var = function(_var, val) {
      if (!this.var_defined(_var)) {
        _var.error_cant_set();
      }
      return this.vars[_var.name].val = val;
    };

    Scope.prototype.get_val = function(_var) {
      var _ref1;
      return (_ref1 = this.vars[_var.name]) != null ? _ref1.val : void 0;
    };

    Scope.prototype.quiet_def_var = function(_var) {
      try {
        return this.def_var(_var);
      } catch (_error) {}
    };

    Scope.prototype.var_stmt = function() {
      var c_vars, _var;
      if (Object.keys(this.vars).length) {
        c_vars = (function() {
          var _ref1, _results;
          _ref1 = this.vars;
          _results = [];
          for (name in _ref1) {
            if (!__hasProp.call(_ref1, name)) continue;
            _var = _ref1[name]._var;
            _results.push(_var._compile());
          }
          return _results;
        }).call(this);
        return "var " + (c_vars.join(', ')) + ";\n";
      } else {
        return '';
      }
    };

    return Scope;

  })();

  C.String = (function(_super) {

    __extends(String, _super);

    function String(value) {
      this.value = value;
      String.__super__.constructor.apply(this, arguments);
    }

    String.prototype.compile = function() {
      var value;
      value = this.value.replace(/'/, "\\'");
      return "'" + value + "'";
    };

    String.prototype.toString = function() {
      return this.compile();
    };

    return String;

  })(C.Construct);

  C.Symbol = (function(_super) {

    __extends(Symbol, _super);

    function Symbol(name) {
      this.name = name;
      if (this.name instanceof C.Symbol) {
        this.name = this.name.name;
      }
      Symbol.__super__.constructor.apply(this, arguments);
    }

    Symbol.prototype.compile = function() {
      return C.Var.text_to_js_identifier(this.name);
    };

    Symbol.prototype.error_cant_redefine = function() {
      return this.error("Can't redefine var " + this.name);
    };

    Symbol.prototype.error_cant_set = function() {
      return this.error("Can't set nonexistant var " + this.name);
    };

    Symbol.gensym = function(s, yy) {
      var now, rand;
      if (s == null) {
        s = "sym";
      }
      if (s instanceof C.Symbol) {
        s = s.name;
      }
      now = (+new Date()).toString(36);
      rand = Math.floor(Math.random() * 1e6).toString(36);
      return new this("" + s + "-" + rand + "-" + now, yy);
    };

    Symbol.text_to_js_identifier = function(text, conversions) {
      var _char_wrapper;
      if ((this.JS_KEYWORDS.indexOf(text)) >= 0) {
        return this.wrapper(text);
      }
      if (text.length === 0) {
        return this.wrapper("null");
      }
      _char_wrapper = this.char_wrapper.bind(this, conversions);
      return ((text.replace(this.WRAPPER_REGEX, this.wrapper)).replace(/^\d/, _char_wrapper)).replace(/[^\w\$]/g, _char_wrapper);
    };

    Symbol.char_wrapper = function(conversions, _char) {
      var txt, _ref1, _ref2;
      if (conversions == null) {
        conversions = {};
      }
      txt = (_ref1 = (_ref2 = conversions[_char]) != null ? _ref2 : this.JS_ILLEGAL_IDENTIFIER_CHARS[_char]) != null ? _ref1 : "ASCII_" + (_char.charCodeAt(0));
      return this.wrapper(txt);
    };

    Symbol.wrapper = function(text) {
      return "" + this.WRAPPER_PREFIX + text + this.WRAPPER_SUFFIX;
    };

    Symbol.WRAPPER_PREFIX = "_$";

    Symbol.WRAPPER_SUFFIX = "_";

    Symbol.WRAPPER_REGEX = /_\$[^_]+_/g;

    Symbol.JS_KEYWORDS = ["break", "case", "catch", "char", "class", "const", "continue", "debugger", "default", "delete", "do", "else", "enum", "export", "extends", "false", "finally", "for", "function", "if", "implements", "import", "in", "instanceof", "interface", "let", "new", "null", "package", "private", "protected", "public", "return", "static", "switch", "super", "this", "throw", "true", "try", "typeof", "undefined", "var", "void", "while", "with", "yield"];

    Symbol.JS_ILLEGAL_IDENTIFIER_CHARS = {
      "~": "tilde",
      "`": "backtick",
      "!": "exclamationmark",
      "@": "at",
      "#": "pound",
      "%": "percent",
      "^": "carat",
      "&": "amperstand",
      "*": "asterisk",
      "(": "leftparen",
      ")": "rightparen",
      "-": "dash",
      "+": "plus",
      "=": "equals",
      "{": "leftcurly",
      "}": "rightcurly",
      "[": "leftsquare",
      "]": "rightsquare",
      "|": "pipe",
      "\\": "backslash",
      "\"": "doublequote",
      "'": "singlequote",
      ":": "colon",
      ";": "semicolon",
      "<": "leftangle",
      ">": "rightangle",
      ",": "comma",
      ".": "period",
      "?": "questionmark",
      "/": "forwardslash",
      " ": "space",
      "\t": "tab",
      "\n": "newline",
      "\r": "carriagereturn"
    };

    return Symbol;

  })(C.Construct);

  C.Var = (function(_super) {

    __extends(Var, _super);

    function Var() {
      var scope;
      Var.__super__.constructor.apply(this, arguments);
      scope = C.current_scope();
      scope.def_var(this);
    }

    return Var;

  })(C.Symbol);

  C.Var.Set = (function(_super) {

    __extends(Set, _super);

    function Set(_arg, yy) {
      var scope, value, _ref1;
      this._var = _arg._var, value = _arg.value, this.must_exist = _arg.must_exist;
      Set.__super__.constructor.apply(this, arguments);
      this.value = value;
      if ((_ref1 = this.must_exist) == null) {
        this.must_exist = true;
      }
      scope = C.find_scope_with_var(this._var);
      if (this.must_exist && !scope) {
        this._var.error_cant_set();
      }
      if (scope != null) {
        scope.set_var(this._var, this.value);
      }
    }

    Set.prototype.compile = function() {
      var c_val, c_var;
      c_var = this._var._compile();
      c_val = this.value._compile();
      return "" + c_var + " = " + c_val;
    };

    return Set;

  })(C.Construct);

}).call(this);
/* Jison generated parser */
var parser = (function(){
var parser = {trace: function trace() { },
yy: {},
symbols_: {"error":2,"program":3,"s_expression_list":4,"EOF":5,"s_expression":6,"special_form":7,"list":8,"symbol":9,"literal":10,"callable_list":11,"array":12,"object":13,"(":14,"element_list":15,")":16,"[":17,"]":18,"OBJECT":19,"kvpair_list":20,"OBJECT_END":21,"kvpair":22,"element":23,"QUOTE":24,"QUASIQUOTE":25,"UNQUOTE":26,"UNQUOTE_SPLICING":27,"FUNCTION":28,"string":29,"regex":30,"number":31,"atom":32,"BOOLEAN_TRUE":33,"BOOLEAN_FALSE":34,"REGEX":35,"FLAGS":36,"FIXNUM":37,"FLOAT":38,"BASENUM":39,"STRING":40,"keyword":41,"KEYWORD":42,"IDENTIFIER":43,"$accept":0,"$end":1},
terminals_: {2:"error",5:"EOF",14:"(",16:")",17:"[",18:"]",19:"OBJECT",21:"OBJECT_END",24:"QUOTE",25:"QUASIQUOTE",26:"UNQUOTE",27:"UNQUOTE_SPLICING",28:"FUNCTION",33:"BOOLEAN_TRUE",34:"BOOLEAN_FALSE",35:"REGEX",36:"FLAGS",37:"FIXNUM",38:"FLOAT",39:"BASENUM",40:"STRING",42:"KEYWORD",43:"IDENTIFIER"},
productions_: [0,[3,2],[3,1],[4,2],[4,1],[6,1],[6,1],[6,1],[6,1],[8,1],[8,1],[8,1],[11,3],[12,3],[12,2],[13,3],[13,2],[20,1],[20,2],[22,2],[15,1],[15,2],[23,1],[7,2],[7,2],[7,2],[7,2],[7,3],[10,1],[10,1],[10,1],[10,1],[32,2],[32,1],[32,1],[30,2],[31,1],[31,1],[31,1],[29,1],[29,1],[41,2],[9,1]],
performAction: function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$) {

var $0 = $$.length - 1;
switch (yystate) {
case 1:
      $$[$0-1].unshift(new C.Raw("var eval = " + sym("oppo-eval").compile()));
      var lambda = new C.Lambda({body: $$[$0-1]}, yy);
      //return new C.List([lambda], yy);
      return lambda;
    
break;
case 2: return new C.Null(yy); 
break;
case 3: this.$ = $$[$0-1]; this.$.push($$[$0]); 
break;
case 4: this.$ = [$$[$0]]; 
break;
case 12: this.$ = new C.List($$[$0-1], yy); 
break;
case 13: this.$ = call_by_name("array", $$[$0-1], yy); 
break;
case 14: this.$ = call_by_name("array", [], yy); 
break;
case 15: this.$ = new C.Object($$[$0-1], yy); 
break;
case 16: this.$ = new C.Object([], yy); 
break;
case 17: this.$ = [$$[$0]]; 
break;
case 18: this.$ = $$[$0-1]; this.$.push($$[$0]); 
break;
case 19: this.$ = [$$[$0-1], $$[$0]]; 
break;
case 20: this.$ = [$$[$0]]; 
break;
case 21: this.$ = $$[$0-1]; this.$.push($$[$0]); 
break;
case 23: this.$ = $$[$0]; this.$.quoted = true; 
break;
case 24: this.$ = $$[$0]; this.$.quasiquoted = true; 
break;
case 25: this.$ = $$[$0]; this.$.unquoted = true; 
break;
case 26: this.$ = $$[$0]; this.$.unquote_spliced = true; 
break;
case 27: this.$ = new C.Lambda({body: $$[$0-1], arity: Infinity}, yy); 
break;
case 32: this.$ = new C.Null(yy); 
break;
case 33: this.$ = new C.True(yy); 
break;
case 34: this.$ = new C.False(yy); 
break;
case 35: this.$ = new C.Regex({pattern: $$[$0-1], modifiers: $$[$0].substr(1)}, yy); 
break;
case 36: this.$ = new C.Number($$[$0], yy); 
break;
case 37: this.$ = new C.Number($$[$0], yy); 
break;
case 38:
      var basenum = $$[$0].split('#');
      this.$ = new C.Number({value: basenum[1], base: basenum[0]}, yy);
    
break;
case 39: this.$ = new C.String($$[$0], yy); 
break;
case 41: this.$ = new C.Keyword($$[$0].value, yy); 
break;
case 42:
      if (/^nil$/i.test($$[$0]))
        this.$ = new C.Null(yy);
      else if (/^true$/i.test($$[$0]))
        this.$ = new C.True(yy);
      else if (/^false$/i.test($$[$0]))
        this.$ = new C.False(yy);
      else
        this.$ = new C.Symbol($$[$0], yy);
    
break;
}
},
table: [{3:1,4:2,5:[1,3],6:4,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{1:[3]},{5:[1,34],6:35,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{1:[2,2]},{5:[2,4],14:[2,4],17:[2,4],19:[2,4],24:[2,4],25:[2,4],26:[2,4],27:[2,4],28:[2,4],33:[2,4],34:[2,4],35:[2,4],37:[2,4],38:[2,4],39:[2,4],40:[2,4],42:[2,4],43:[2,4]},{5:[2,5],14:[2,5],16:[2,5],17:[2,5],18:[2,5],19:[2,5],21:[2,5],24:[2,5],25:[2,5],26:[2,5],27:[2,5],28:[2,5],33:[2,5],34:[2,5],35:[2,5],37:[2,5],38:[2,5],39:[2,5],40:[2,5],42:[2,5],43:[2,5]},{5:[2,6],14:[2,6],16:[2,6],17:[2,6],18:[2,6],19:[2,6],21:[2,6],24:[2,6],25:[2,6],26:[2,6],27:[2,6],28:[2,6],33:[2,6],34:[2,6],35:[2,6],37:[2,6],38:[2,6],39:[2,6],40:[2,6],42:[2,6],43:[2,6]},{5:[2,7],14:[2,7],16:[2,7],17:[2,7],18:[2,7],19:[2,7],21:[2,7],24:[2,7],25:[2,7],26:[2,7],27:[2,7],28:[2,7],33:[2,7],34:[2,7],35:[2,7],37:[2,7],38:[2,7],39:[2,7],40:[2,7],42:[2,7],43:[2,7]},{5:[2,8],14:[2,8],16:[2,8],17:[2,8],18:[2,8],19:[2,8],21:[2,8],24:[2,8],25:[2,8],26:[2,8],27:[2,8],28:[2,8],33:[2,8],34:[2,8],35:[2,8],37:[2,8],38:[2,8],39:[2,8],40:[2,8],42:[2,8],43:[2,8]},{6:36,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{6:37,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{6:38,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{6:39,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],15:40,17:[1,23],19:[1,24],23:41,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{5:[2,9],14:[2,9],16:[2,9],17:[2,9],18:[2,9],19:[2,9],21:[2,9],24:[2,9],25:[2,9],26:[2,9],27:[2,9],28:[2,9],33:[2,9],34:[2,9],35:[2,9],37:[2,9],38:[2,9],39:[2,9],40:[2,9],42:[2,9],43:[2,9]},{5:[2,10],14:[2,10],16:[2,10],17:[2,10],18:[2,10],19:[2,10],21:[2,10],24:[2,10],25:[2,10],26:[2,10],27:[2,10],28:[2,10],33:[2,10],34:[2,10],35:[2,10],37:[2,10],38:[2,10],39:[2,10],40:[2,10],42:[2,10],43:[2,10]},{5:[2,11],14:[2,11],16:[2,11],17:[2,11],18:[2,11],19:[2,11],21:[2,11],24:[2,11],25:[2,11],26:[2,11],27:[2,11],28:[2,11],33:[2,11],34:[2,11],35:[2,11],37:[2,11],38:[2,11],39:[2,11],40:[2,11],42:[2,11],43:[2,11]},{5:[2,42],14:[2,42],16:[2,42],17:[2,42],18:[2,42],19:[2,42],21:[2,42],24:[2,42],25:[2,42],26:[2,42],27:[2,42],28:[2,42],33:[2,42],34:[2,42],35:[2,42],37:[2,42],38:[2,42],39:[2,42],40:[2,42],42:[2,42],43:[2,42]},{5:[2,28],14:[2,28],16:[2,28],17:[2,28],18:[2,28],19:[2,28],21:[2,28],24:[2,28],25:[2,28],26:[2,28],27:[2,28],28:[2,28],33:[2,28],34:[2,28],35:[2,28],37:[2,28],38:[2,28],39:[2,28],40:[2,28],42:[2,28],43:[2,28]},{5:[2,29],14:[2,29],16:[2,29],17:[2,29],18:[2,29],19:[2,29],21:[2,29],24:[2,29],25:[2,29],26:[2,29],27:[2,29],28:[2,29],33:[2,29],34:[2,29],35:[2,29],37:[2,29],38:[2,29],39:[2,29],40:[2,29],42:[2,29],43:[2,29]},{5:[2,30],14:[2,30],16:[2,30],17:[2,30],18:[2,30],19:[2,30],21:[2,30],24:[2,30],25:[2,30],26:[2,30],27:[2,30],28:[2,30],33:[2,30],34:[2,30],35:[2,30],37:[2,30],38:[2,30],39:[2,30],40:[2,30],42:[2,30],43:[2,30]},{5:[2,31],14:[2,31],16:[2,31],17:[2,31],18:[2,31],19:[2,31],21:[2,31],24:[2,31],25:[2,31],26:[2,31],27:[2,31],28:[2,31],33:[2,31],34:[2,31],35:[2,31],37:[2,31],38:[2,31],39:[2,31],40:[2,31],42:[2,31],43:[2,31]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],15:43,16:[1,44],17:[1,23],19:[1,24],23:41,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],15:45,17:[1,23],18:[1,46],19:[1,24],23:41,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],20:47,21:[1,48],22:49,23:50,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{5:[2,39],14:[2,39],16:[2,39],17:[2,39],18:[2,39],19:[2,39],21:[2,39],24:[2,39],25:[2,39],26:[2,39],27:[2,39],28:[2,39],33:[2,39],34:[2,39],35:[2,39],37:[2,39],38:[2,39],39:[2,39],40:[2,39],42:[2,39],43:[2,39]},{5:[2,40],14:[2,40],16:[2,40],17:[2,40],18:[2,40],19:[2,40],21:[2,40],24:[2,40],25:[2,40],26:[2,40],27:[2,40],28:[2,40],33:[2,40],34:[2,40],35:[2,40],37:[2,40],38:[2,40],39:[2,40],40:[2,40],42:[2,40],43:[2,40]},{36:[1,51]},{5:[2,36],14:[2,36],16:[2,36],17:[2,36],18:[2,36],19:[2,36],21:[2,36],24:[2,36],25:[2,36],26:[2,36],27:[2,36],28:[2,36],33:[2,36],34:[2,36],35:[2,36],37:[2,36],38:[2,36],39:[2,36],40:[2,36],42:[2,36],43:[2,36]},{5:[2,37],14:[2,37],16:[2,37],17:[2,37],18:[2,37],19:[2,37],21:[2,37],24:[2,37],25:[2,37],26:[2,37],27:[2,37],28:[2,37],33:[2,37],34:[2,37],35:[2,37],37:[2,37],38:[2,37],39:[2,37],40:[2,37],42:[2,37],43:[2,37]},{5:[2,38],14:[2,38],16:[2,38],17:[2,38],18:[2,38],19:[2,38],21:[2,38],24:[2,38],25:[2,38],26:[2,38],27:[2,38],28:[2,38],33:[2,38],34:[2,38],35:[2,38],37:[2,38],38:[2,38],39:[2,38],40:[2,38],42:[2,38],43:[2,38]},{5:[2,33],14:[2,33],16:[2,33],17:[2,33],18:[2,33],19:[2,33],21:[2,33],24:[2,33],25:[2,33],26:[2,33],27:[2,33],28:[2,33],33:[2,33],34:[2,33],35:[2,33],37:[2,33],38:[2,33],39:[2,33],40:[2,33],42:[2,33],43:[2,33]},{5:[2,34],14:[2,34],16:[2,34],17:[2,34],18:[2,34],19:[2,34],21:[2,34],24:[2,34],25:[2,34],26:[2,34],27:[2,34],28:[2,34],33:[2,34],34:[2,34],35:[2,34],37:[2,34],38:[2,34],39:[2,34],40:[2,34],42:[2,34],43:[2,34]},{9:52,43:[1,17]},{1:[2,1]},{5:[2,3],14:[2,3],17:[2,3],19:[2,3],24:[2,3],25:[2,3],26:[2,3],27:[2,3],28:[2,3],33:[2,3],34:[2,3],35:[2,3],37:[2,3],38:[2,3],39:[2,3],40:[2,3],42:[2,3],43:[2,3]},{5:[2,23],14:[2,23],16:[2,23],17:[2,23],18:[2,23],19:[2,23],21:[2,23],24:[2,23],25:[2,23],26:[2,23],27:[2,23],28:[2,23],33:[2,23],34:[2,23],35:[2,23],37:[2,23],38:[2,23],39:[2,23],40:[2,23],42:[2,23],43:[2,23]},{5:[2,24],14:[2,24],16:[2,24],17:[2,24],18:[2,24],19:[2,24],21:[2,24],24:[2,24],25:[2,24],26:[2,24],27:[2,24],28:[2,24],33:[2,24],34:[2,24],35:[2,24],37:[2,24],38:[2,24],39:[2,24],40:[2,24],42:[2,24],43:[2,24]},{5:[2,25],14:[2,25],16:[2,25],17:[2,25],18:[2,25],19:[2,25],21:[2,25],24:[2,25],25:[2,25],26:[2,25],27:[2,25],28:[2,25],33:[2,25],34:[2,25],35:[2,25],37:[2,25],38:[2,25],39:[2,25],40:[2,25],42:[2,25],43:[2,25]},{5:[2,26],14:[2,26],16:[2,26],17:[2,26],18:[2,26],19:[2,26],21:[2,26],24:[2,26],25:[2,26],26:[2,26],27:[2,26],28:[2,26],33:[2,26],34:[2,26],35:[2,26],37:[2,26],38:[2,26],39:[2,26],40:[2,26],42:[2,26],43:[2,26]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],16:[1,53],17:[1,23],19:[1,24],23:54,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{14:[2,20],16:[2,20],17:[2,20],18:[2,20],19:[2,20],24:[2,20],25:[2,20],26:[2,20],27:[2,20],28:[2,20],33:[2,20],34:[2,20],35:[2,20],37:[2,20],38:[2,20],39:[2,20],40:[2,20],42:[2,20],43:[2,20]},{14:[2,22],16:[2,22],17:[2,22],18:[2,22],19:[2,22],21:[2,22],24:[2,22],25:[2,22],26:[2,22],27:[2,22],28:[2,22],33:[2,22],34:[2,22],35:[2,22],37:[2,22],38:[2,22],39:[2,22],40:[2,22],42:[2,22],43:[2,22]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],16:[1,55],17:[1,23],19:[1,24],23:54,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{5:[2,32],14:[2,32],16:[2,32],17:[2,32],18:[2,32],19:[2,32],21:[2,32],24:[2,32],25:[2,32],26:[2,32],27:[2,32],28:[2,32],33:[2,32],34:[2,32],35:[2,32],37:[2,32],38:[2,32],39:[2,32],40:[2,32],42:[2,32],43:[2,32]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],18:[1,56],19:[1,24],23:54,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{5:[2,14],14:[2,14],16:[2,14],17:[2,14],18:[2,14],19:[2,14],21:[2,14],24:[2,14],25:[2,14],26:[2,14],27:[2,14],28:[2,14],33:[2,14],34:[2,14],35:[2,14],37:[2,14],38:[2,14],39:[2,14],40:[2,14],42:[2,14],43:[2,14]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],21:[1,57],22:58,23:50,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{5:[2,16],14:[2,16],16:[2,16],17:[2,16],18:[2,16],19:[2,16],21:[2,16],24:[2,16],25:[2,16],26:[2,16],27:[2,16],28:[2,16],33:[2,16],34:[2,16],35:[2,16],37:[2,16],38:[2,16],39:[2,16],40:[2,16],42:[2,16],43:[2,16]},{14:[2,17],17:[2,17],19:[2,17],21:[2,17],24:[2,17],25:[2,17],26:[2,17],27:[2,17],28:[2,17],33:[2,17],34:[2,17],35:[2,17],37:[2,17],38:[2,17],39:[2,17],40:[2,17],42:[2,17],43:[2,17]},{6:42,7:5,8:6,9:7,10:8,11:14,12:15,13:16,14:[1,22],17:[1,23],19:[1,24],23:59,24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13],29:18,30:19,31:20,32:21,33:[1,31],34:[1,32],35:[1,27],37:[1,28],38:[1,29],39:[1,30],40:[1,25],41:26,42:[1,33],43:[1,17]},{5:[2,35],14:[2,35],16:[2,35],17:[2,35],18:[2,35],19:[2,35],21:[2,35],24:[2,35],25:[2,35],26:[2,35],27:[2,35],28:[2,35],33:[2,35],34:[2,35],35:[2,35],37:[2,35],38:[2,35],39:[2,35],40:[2,35],42:[2,35],43:[2,35]},{5:[2,41],14:[2,41],16:[2,41],17:[2,41],18:[2,41],19:[2,41],21:[2,41],24:[2,41],25:[2,41],26:[2,41],27:[2,41],28:[2,41],33:[2,41],34:[2,41],35:[2,41],37:[2,41],38:[2,41],39:[2,41],40:[2,41],42:[2,41],43:[2,41]},{5:[2,27],14:[2,27],16:[2,27],17:[2,27],18:[2,27],19:[2,27],21:[2,27],24:[2,27],25:[2,27],26:[2,27],27:[2,27],28:[2,27],33:[2,27],34:[2,27],35:[2,27],37:[2,27],38:[2,27],39:[2,27],40:[2,27],42:[2,27],43:[2,27]},{14:[2,21],16:[2,21],17:[2,21],18:[2,21],19:[2,21],24:[2,21],25:[2,21],26:[2,21],27:[2,21],28:[2,21],33:[2,21],34:[2,21],35:[2,21],37:[2,21],38:[2,21],39:[2,21],40:[2,21],42:[2,21],43:[2,21]},{5:[2,12],14:[2,12],16:[2,12],17:[2,12],18:[2,12],19:[2,12],21:[2,12],24:[2,12],25:[2,12],26:[2,12],27:[2,12],28:[2,12],33:[2,12],34:[2,12],35:[2,12],37:[2,12],38:[2,12],39:[2,12],40:[2,12],42:[2,12],43:[2,12]},{5:[2,13],14:[2,13],16:[2,13],17:[2,13],18:[2,13],19:[2,13],21:[2,13],24:[2,13],25:[2,13],26:[2,13],27:[2,13],28:[2,13],33:[2,13],34:[2,13],35:[2,13],37:[2,13],38:[2,13],39:[2,13],40:[2,13],42:[2,13],43:[2,13]},{5:[2,15],14:[2,15],16:[2,15],17:[2,15],18:[2,15],19:[2,15],21:[2,15],24:[2,15],25:[2,15],26:[2,15],27:[2,15],28:[2,15],33:[2,15],34:[2,15],35:[2,15],37:[2,15],38:[2,15],39:[2,15],40:[2,15],42:[2,15],43:[2,15]},{14:[2,18],17:[2,18],19:[2,18],21:[2,18],24:[2,18],25:[2,18],26:[2,18],27:[2,18],28:[2,18],33:[2,18],34:[2,18],35:[2,18],37:[2,18],38:[2,18],39:[2,18],40:[2,18],42:[2,18],43:[2,18]},{14:[2,19],17:[2,19],19:[2,19],21:[2,19],24:[2,19],25:[2,19],26:[2,19],27:[2,19],28:[2,19],33:[2,19],34:[2,19],35:[2,19],37:[2,19],38:[2,19],39:[2,19],40:[2,19],42:[2,19],43:[2,19]}],
defaultActions: {3:[2,2],34:[2,1]},
parseError: function parseError(str, hash) {
    throw new Error(str);
},
parse: function parse(input) {
    var self = this, stack = [0], vstack = [null], lstack = [], table = this.table, yytext = "", yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;
    this.lexer.setInput(input);
    this.lexer.yy = this.yy;
    this.yy.lexer = this.lexer;
    this.yy.parser = this;
    if (typeof this.lexer.yylloc == "undefined")
        this.lexer.yylloc = {};
    var yyloc = this.lexer.yylloc;
    lstack.push(yyloc);
    var ranges = this.lexer.options && this.lexer.options.ranges;
    if (typeof this.yy.parseError === "function")
        this.parseError = this.yy.parseError;
    function popStack(n) {
        stack.length = stack.length - 2 * n;
        vstack.length = vstack.length - n;
        lstack.length = lstack.length - n;
    }
    function lex() {
        var token;
        token = self.lexer.lex() || 1;
        if (typeof token !== "number") {
            token = self.symbols_[token] || token;
        }
        return token;
    }
    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;
    while (true) {
        state = stack[stack.length - 1];
        if (this.defaultActions[state]) {
            action = this.defaultActions[state];
        } else {
            if (symbol === null || typeof symbol == "undefined") {
                symbol = lex();
            }
            action = table[state] && table[state][symbol];
        }
        if (typeof action === "undefined" || !action.length || !action[0]) {
            var errStr = "";
            if (!recovering) {
                expected = [];
                for (p in table[state])
                    if (this.terminals_[p] && p > 2) {
                        expected.push("'" + this.terminals_[p] + "'");
                    }
                if (this.lexer.showPosition) {
                    errStr = "Parse error on line " + (yylineno + 1) + ":\n" + this.lexer.showPosition() + "\nExpecting " + expected.join(", ") + ", got '" + (this.terminals_[symbol] || symbol) + "'";
                } else {
                    errStr = "Parse error on line " + (yylineno + 1) + ": Unexpected " + (symbol == 1?"end of input":"'" + (this.terminals_[symbol] || symbol) + "'");
                }
                this.parseError(errStr, {text: this.lexer.match, token: this.terminals_[symbol] || symbol, line: this.lexer.yylineno, loc: yyloc, expected: expected});
            }
        }
        if (action[0] instanceof Array && action.length > 1) {
            throw new Error("Parse Error: multiple actions possible at state: " + state + ", token: " + symbol);
        }
        switch (action[0]) {
        case 1:
            stack.push(symbol);
            vstack.push(this.lexer.yytext);
            lstack.push(this.lexer.yylloc);
            stack.push(action[1]);
            symbol = null;
            if (!preErrorSymbol) {
                yyleng = this.lexer.yyleng;
                yytext = this.lexer.yytext;
                yylineno = this.lexer.yylineno;
                yyloc = this.lexer.yylloc;
                if (recovering > 0)
                    recovering--;
            } else {
                symbol = preErrorSymbol;
                preErrorSymbol = null;
            }
            break;
        case 2:
            len = this.productions_[action[1]][1];
            yyval.$ = vstack[vstack.length - len];
            yyval._$ = {first_line: lstack[lstack.length - (len || 1)].first_line, last_line: lstack[lstack.length - 1].last_line, first_column: lstack[lstack.length - (len || 1)].first_column, last_column: lstack[lstack.length - 1].last_column};
            if (ranges) {
                yyval._$.range = [lstack[lstack.length - (len || 1)].range[0], lstack[lstack.length - 1].range[1]];
            }
            r = this.performAction.call(yyval, yytext, yyleng, yylineno, this.yy, action[1], vstack, lstack);
            if (typeof r !== "undefined") {
                return r;
            }
            if (len) {
                stack = stack.slice(0, -1 * len * 2);
                vstack = vstack.slice(0, -1 * len);
                lstack = lstack.slice(0, -1 * len);
            }
            stack.push(this.productions_[action[1]][0]);
            vstack.push(yyval.$);
            lstack.push(yyval._$);
            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];
            stack.push(newState);
            break;
        case 3:
            return true;
        }
    }
    return true;
}
};

  var L = typeof lemur === "undefined" ? require('lemur') : lemur;
  var C = L.Compiler;

  var sym = function (s, yy) {
    return new C.Symbol(s, yy)
  };

  var slice = Array.prototype.slice;
  var call_by_name = function (sname, args, yy) {
    var s = sym(sname, yy);
    return new C.List([s].concat(args), yy);
  };

  var types = {}; // oppo.compiler.types;
/* Jison generated lexer */
var lexer = (function(){
var lexer = ({EOF:1,
parseError:function parseError(str, hash) {
        if (this.yy.parser) {
            this.yy.parser.parseError(str, hash);
        } else {
            throw new Error(str);
        }
    },
setInput:function (input) {
        this._input = input;
        this._more = this._less = this.done = false;
        this.yylineno = this.yyleng = 0;
        this.yytext = this.matched = this.match = '';
        this.conditionStack = ['INITIAL'];
        this.yylloc = {first_line:1,first_column:0,last_line:1,last_column:0};
        if (this.options.ranges) this.yylloc.range = [0,0];
        this.offset = 0;
        return this;
    },
input:function () {
        var ch = this._input[0];
        this.yytext += ch;
        this.yyleng++;
        this.offset++;
        this.match += ch;
        this.matched += ch;
        var lines = ch.match(/(?:\r\n?|\n).*/g);
        if (lines) {
            this.yylineno++;
            this.yylloc.last_line++;
        } else {
            this.yylloc.last_column++;
        }
        if (this.options.ranges) this.yylloc.range[1]++;

        this._input = this._input.slice(1);
        return ch;
    },
unput:function (ch) {
        var len = ch.length;
        var lines = ch.split(/(?:\r\n?|\n)/g);

        this._input = ch + this._input;
        this.yytext = this.yytext.substr(0, this.yytext.length-len-1);
        //this.yyleng -= len;
        this.offset -= len;
        var oldLines = this.match.split(/(?:\r\n?|\n)/g);
        this.match = this.match.substr(0, this.match.length-1);
        this.matched = this.matched.substr(0, this.matched.length-1);

        if (lines.length-1) this.yylineno -= lines.length-1;
        var r = this.yylloc.range;

        this.yylloc = {first_line: this.yylloc.first_line,
          last_line: this.yylineno+1,
          first_column: this.yylloc.first_column,
          last_column: lines ?
              (lines.length === oldLines.length ? this.yylloc.first_column : 0) + oldLines[oldLines.length - lines.length].length - lines[0].length:
              this.yylloc.first_column - len
          };

        if (this.options.ranges) {
            this.yylloc.range = [r[0], r[0] + this.yyleng - len];
        }
        return this;
    },
more:function () {
        this._more = true;
        return this;
    },
less:function (n) {
        this.unput(this.match.slice(n));
    },
pastInput:function () {
        var past = this.matched.substr(0, this.matched.length - this.match.length);
        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\n/g, "");
    },
upcomingInput:function () {
        var next = this.match;
        if (next.length < 20) {
            next += this._input.substr(0, 20-next.length);
        }
        return (next.substr(0,20)+(next.length > 20 ? '...':'')).replace(/\n/g, "");
    },
showPosition:function () {
        var pre = this.pastInput();
        var c = new Array(pre.length + 1).join("-");
        return pre + this.upcomingInput() + "\n" + c+"^";
    },
next:function () {
        if (this.done) {
            return this.EOF;
        }
        if (!this._input) this.done = true;

        var token,
            match,
            tempMatch,
            index,
            col,
            lines;
        if (!this._more) {
            this.yytext = '';
            this.match = '';
        }
        var rules = this._currentRules();
        for (var i=0;i < rules.length; i++) {
            tempMatch = this._input.match(this.rules[rules[i]]);
            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {
                match = tempMatch;
                index = i;
                if (!this.options.flex) break;
            }
        }
        if (match) {
            lines = match[0].match(/(?:\r\n?|\n).*/g);
            if (lines) this.yylineno += lines.length;
            this.yylloc = {first_line: this.yylloc.last_line,
                           last_line: this.yylineno+1,
                           first_column: this.yylloc.last_column,
                           last_column: lines ? lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length : this.yylloc.last_column + match[0].length};
            this.yytext += match[0];
            this.match += match[0];
            this.matches = match;
            this.yyleng = this.yytext.length;
            if (this.options.ranges) {
                this.yylloc.range = [this.offset, this.offset += this.yyleng];
            }
            this._more = false;
            this._input = this._input.slice(match[0].length);
            this.matched += match[0];
            token = this.performAction.call(this, this.yy, this, rules[index],this.conditionStack[this.conditionStack.length-1]);
            if (this.done && this._input) this.done = false;
            if (token) return token;
            else return;
        }
        if (this._input === "") {
            return this.EOF;
        } else {
            return this.parseError('Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\n'+this.showPosition(),
                    {text: "", token: null, line: this.yylineno});
        }
    },
lex:function lex() {
        var r = this.next();
        if (typeof r !== 'undefined') {
            return r;
        } else {
            return this.lex();
        }
    },
begin:function begin(condition) {
        this.conditionStack.push(condition);
    },
popState:function popState() {
        return this.conditionStack.pop();
    },
_currentRules:function _currentRules() {
        return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;
    },
topState:function () {
        return this.conditionStack[this.conditionStack.length-2];
    },
pushState:function begin(condition) {
        this.begin(condition);
    }});
lexer.options = {};
lexer.performAction = function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {

var YYSTATE=YY_START
switch($avoiding_name_collisions) {
case 0: /* comment */ 
break;
case 1: /* ignore */ 
break;
case 2: this.begin('string'); this.string_buffer = ""; 
break;
case 3: this.popState(); yy_.yytext = this.string_buffer; return 40; 
break;
case 4:this.string_buffer = yy_.yytext;
break;
case 5:this.begin('regex');
break;
case 6: this.popState(); return 36; 
break;
case 7: return 35; 
break;
case 8: return 38; 
break;
case 9: return 39; 
break;
case 10: return 37; 
break;
case 11: return 33; 
break;
case 12: return 34; 
break;
case 13: return 14; 
break;
case 14: return 16; 
break;
case 15: return 17; 
break;
case 16: return 18; 
break;
case 17: return 19; 
break;
case 18: return 21; 
break;
case 19: return 26; 
break;
case 20: return 24; 
break;
case 21: return 25; 
break;
case 22: return 27; 
break;
case 23: return 28; 
break;
case 24: return 42; 
break;
case 25: return 43; 
break;
case 26: return 5; 
break;
case 27: return 'INVALID'; 
break;
}
};
lexer.rules = [/^(?:;.*)/,/^(?:\s+)/,/^(?:")/,/^(?:")/,/^(?:(\\"|[^"])*)/,/^(?:#\/)/,/^(?:\/[a-zA-Z]*)/,/^(?:(\\\/|[^\/])*)/,/^(?:[\+\-]?\d*\.\d+)/,/^(?:\d{1,2}#[\+\-]?\w+)/,/^(?:[\+\-]?\d+)/,/^(?:#[tT]{1})/,/^(?:#[fF]{1})/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?:,)/,/^(?:')/,/^(?:`)/,/^(?:,@)/,/^(?:#\()/,/^(?::)/,/^(?:[\w@#\.:!\$%\^&\*\-\+='"\?\|\/\\<>~]+)/,/^(?:$)/,/^(?:.)/];
lexer.conditions = {"string":{"rules":[3,4],"inclusive":false},"regex":{"rules":[6,7],"inclusive":false},"INITIAL":{"rules":[0,1,2,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27],"inclusive":true}};
return lexer;})()
parser.lexer = lexer;function Parser () { this.yy = {}; }Parser.prototype = parser;parser.Parser = Parser;
return new Parser;
})();
if (typeof require !== 'undefined' && typeof exports !== 'undefined') {
exports.parser = parser;
exports.Parser = parser.Parser;
exports.parse = function () { return parser.parse.apply(parser, arguments); }
exports.main = function commonjsMain(args) {
    if (!args[1])
        throw new Error('Usage: '+args[0]+' FILE');
    var source, cwd;
    if (typeof process !== 'undefined') {
        source = require('fs').readFileSync(require('path').resolve(args[1]), "utf8");
    } else {
        source = require("file").path(require("file").cwd()).join(args[1]).read({charset: "utf-8"});
    }
    return exports.parser.parse(source);
}
if (typeof module !== 'undefined' && require.main === module) {
  exports.main(typeof process !== 'undefined' ? process.argv.slice(1) : require("system").args);
}
}// Generated by CoffeeScript 1.3.3
(function() {
  var C, L, binary_op, call_macro, call_macro_transform, clone, compare_op, compile, compile_list, compile_runtime, define, defmacro, keys, last, map, math_op, oppo_eval, pop_shift_op, push_unshift_op, read, root, scope_stack, setup_built_in_macros, trim, type_of, types, _ref, _ref1, _ref2,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  root = typeof global !== "undefined" && global !== null ? global : window;

  L = lemur;

  C = L.Compiler;

  root.oppo = {
    compiler: {
      types: {},
      scope_stack: [{}]
    }
  };

  if ((typeof module !== "undefined" && module !== null ? module.exports : void 0) != null) {
    module.exports = oppo;
  }

  _ref = oppo.compiler, scope_stack = _ref.scope_stack, types = _ref.types;

  oppo.Error = (function(_super) {

    __extends(Error, _super);

    function Error(name, message) {
      this.name = name;
      this.message = message;
    }

    Error.prototype.toString = function() {
      return "" + this.name + ": " + this.message;
    };

    return Error;

  })(Error);

  oppo.ArityException = (function(_super) {

    __extends(ArityException, _super);

    function ArityException(message) {
      if (message != null) {
        this.message = message;
      }
    }

    ArityException.prototype.name = "Arity-Exception";

    ArityException.prototype.message = "Wrong number of arguments";

    return ArityException;

  })(oppo.Error);

  type_of = lemur.core.to_type;

  oppo.stringify = function(o) {
    var items, key, type, value, _ref1;
    type = type_of(o);
    switch (type) {
      case "array":
        return C.List.prototype.toOppoString.call({
          value: o
        });
      case "object":
        if (o instanceof C.Construct) {
          return (_ref1 = typeof o.toOppoString === "function" ? o.toOppoString() : void 0) != null ? _ref1 : o.toString();
        } else {
          items = (function() {
            var _results;
            _results = [];
            for (key in o) {
              value = o[key];
              _results.push("" + (oppo.stringify(key)) + " " + (oppo.stringify(value)));
            }
            return _results;
          })();
          return "{ " + (items.join("\n")) + " }";
        }
        break;
      default:
        return "" + o;
    }
  };

  oppo.stringify_html = function(o) {
    var s;
    s = oppo.stringify(o);
    return s.replace(/\n/g, "<br />");
  };

  clone = (_ref1 = Object.create) != null ? _ref1 : function(o) {
    function ObjectClone () {};
    ObjectClone.prototype = o;
    return new ObjectClone();
  };

  keys = (_ref2 = Object.keys) != null ? _ref2 : function(o) {
    var prop, _results;
    _results = [];
    for (prop in o) {
      if (!__hasProp.call(o, prop)) continue;
      _results.push(prop);
    }
    return _results;
  };

  last = function(list) {
    if ((list != null ? list.length : void 0) != null) {
      return list[list.length - 1];
    }
  };

  map = function(list, fn) {
    var item, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = list.length; _i < _len; _i++) {
      item = list[_i];
      _results.push(fn(item));
    }
    return _results;
  };

  compile_list = function(list, arg, unquoted) {
    var item, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = list.length; _i < _len; _i++) {
      item = list[_i];
      if (unquoted) {
        item.quoted = false;
      }
      _results.push(item._compile(arg));
    }
    return _results;
  };

  trim = String.prototype.trim || function() {
    return this.replace(/^\s+/, '').replace(/\s+$/, '');
  };

  (function() {
    var normal_compile;
    C.Construct.prototype._compile = function() {
      var compile_fn;
      compile_fn = this.quasiquoted ? this.compile_quasiquoted : this.unquoted ? this.compile_unquoted : this.unquote_spliced ? this.compile_unquote_spliced : this.quoted ? this.compile_quoted : this.compile;
      return compile_fn.apply(this, arguments);
    };
    C.Construct.prototype.compile_quoted = function() {
      return "new lemur.Compiler." + this.constructor.name + "('" + this.value + "')";
    };
    normal_compile = function() {
      return this.compile.apply(this, arguments);
    };
    C.Construct.prototype.compile_quasiquoted = normal_compile;
    C.Construct.prototype.compile_unquoted = normal_compile;
    C.Construct.prototype.compile_unquote_spliced = normal_compile;
    C.Number.prototype.valueOf = function() {
      return +this.compile();
    };
    C.Number.prototype.toString = C.Number.prototype.compile;
    C.String.prototype.toString = function() {
      return eval(this.compile());
    };
    C.String.prototype.valueOf = C.String.prototype.toString;
    return C.If.prototype.transform = function() {
      this.then = C.Macro.transform(this.then);
      if (this._else != null) {
        this._else = C.Macro.transform(this._else);
      }
      return this;
    };
  })();

  read = oppo.read = oppo.compiler.read = function() {
    return parser.parse.apply(parser, arguments);
  };

  compile = oppo.compile = oppo.compiler.compile = function(sexp) {
    if ((type_of(sexp)) === "array") {
      sexp = new C.List(sexp);
      sexp = new C.Lambda({
        body: [sexp]
      });
    }
    return new lemur.Compiler().compile(function() {
      var c_sym_prog, prog, r, sym_prog;
      setup_built_in_macros();
      r = compile_runtime();
      sym_prog = C.Var.gensym("program");
      c_sym_prog = sym_prog.compile();
      prog = sexp._compile();
      return "// Your program\nvar " + c_sym_prog + " = " + prog + ";\n\n// Oppo runtime\n" + r + "\n\n// Run the oppo program\nif (lemur.core.to_type(" + c_sym_prog + ") === 'function')\n  " + c_sym_prog + "();\nelse\n  " + c_sym_prog + ";";
    });
  };

  oppo_eval = oppo["eval"] = function(sexp) {
    return root["eval"](compile(sexp));
  };

  C.Keyword = (function(_super) {

    __extends(Keyword, _super);

    function Keyword() {
      return Keyword.__super__.constructor.apply(this, arguments);
    }

    Keyword.prototype.toOppoString = function() {
      return ":" + this.value;
    };

    return Keyword;

  })(C.String);

  C.Lambda = (function(_super) {

    __extends(Lambda, _super);

    function Lambda(config, yy) {
      this.arity = config.arity;
      config.autoreturn = true;
      Lambda.__super__.constructor.call(this, config, yy);
    }

    Lambda.prototype.compile = function() {
      var body, item, result;
      body = this.body;
      this.body = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = body.length; _i < _len; _i++) {
          item = body[_i];
          _results.push(C.Macro.transform(item));
        }
        return _results;
      })();
      result = Lambda.__super__.compile.apply(this, arguments);
      this.body = body;
      return result;
    };

    return Lambda;

  })(C.Function);

  C.List = (function(_super) {

    __extends(List, _super);

    function List() {
      return List.__super__.constructor.apply(this, arguments);
    }

    List.prototype.compile = function() {
      return call_macro.apply(null, ["call"].concat(__slice.call(this.value)));
    };

    List.prototype.compile_quoted = function() {
      var item, items, ret, sym_js_eval;
      sym_js_eval = new C.Symbol("js-eval");
      items = (function() {
        var _i, _len, _ref3, _results;
        _ref3 = this.items;
        _results = [];
        for (_i = 0, _len = _ref3.length; _i < _len; _i++) {
          item = _ref3[_i];
          if (!(this.quasiquoted && item.unquoted)) {
            item.quoted = true;
          }
          _results.push(new C.List([sym_js_eval, new C.String(item._compile())]));
        }
        return _results;
      }).call(this);
      ret = new C.Array(items);
      return ret.compile();
    };

    List.prototype.compile_quasiquoted = function() {
      var grp, ls, sym_ls, value;
      value = this.compile_quoted.apply(this, arguments);
      ls = "new lemur.Compiler.List(" + value + ", " + this.line_number + ")";
      ls = new C.Raw(ls, this.yy);
      sym_ls = C.Var.gensym("ls");
      grp = new C.CommaGroup([
        new C.Var.Set({
          _var: sym_ls,
          value: ls
        }), new C.Raw("" + (sym_ls.compile()) + ".quoted = true"), sym_ls
      ]);
      return grp.compile();
    };

    List.prototype.toOppoString = function() {
      var item, prefix, s_value;
      s_value = (function() {
        var _i, _len, _ref3, _results;
        _ref3 = this.value;
        _results = [];
        for (_i = 0, _len = _ref3.length; _i < _len; _i++) {
          item = _ref3[_i];
          _results.push(oppo.stringify(item));
        }
        return _results;
      }).call(this);
      prefix = this.quoted ? "'" : this.quasiquoted ? "`" : this.unquoted ? "~" : this.unquote_spliced ? "..." : "";
      return "" + prefix + "(" + (s_value.join(' ')) + ")";
    };

    List.prototype.transform = function() {
      if (!(this.quoted || this.quasiquoted || this.unquote_spliced)) {
        return call_macro_transform.apply(null, ["call"].concat(__slice.call(this.value)));
      }
    };

    return List;

  })(C.Array);

  C.Macro = (function(_super) {

    __extends(Macro, _super);

    function Macro(_arg, yy) {
      var name, scope, transform;
      name = _arg.name, this.argnames = _arg.argnames, this.template = _arg.template, transform = _arg.transform, this.invoke = _arg.invoke;
      this.name = new C.Var(name);
      scope = C.current_scope();
      scope.set_var(this.name, this);
      if (transform != null) {
        this.transform = transform;
      }
      Macro.__super__.constructor.call(this, null, yy);
    }

    Macro.prototype.compile = function() {
      return "null";
    };

    Macro.prototype.invoke = function() {
      var args, x;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      x = this.transform.apply(this, args);
      return x.compile();
    };

    Macro.prototype.transform = function() {
      var arg, args, c_template, fn, ls, transformed;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      fn = new C.Lambda({
        body: this.template,
        args: this.argnames
      }, this.yy);
      args = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = args.length; _i < _len; _i++) {
          arg = args[_i];
          arg = arg.clone();
          arg.quoted = true;
          _results.push(arg);
        }
        return _results;
      })();
      ls = new C.List([fn].concat(__slice.call(args)), this.yy);
      c_template = ls.compile();
      transformed = eval(c_template);
      if (transformed instanceof C.List) {
        transformed.quoted = false;
      }
      return transformed;
    };

    Macro.can_transform = function(item) {
      return (item != null) && (item.transform != null) && !item.builtin;
    };

    Macro.transform = function(code) {
      var callable, item, transformed;
      if (code instanceof C.ReturnedConstruct) {
        code = code.value;
      }
      if (code instanceof C.List && !(code.quoted || code.quasiquoted)) {
        callable = code.items[0];
        if (callable instanceof C.Symbol) {
          item = C.get_var_val(callable);
          if (this.can_transform(item)) {
            transformed = item.transform.apply(item, code.items.slice(1));
          }
        }
      }
      if (!transformed && (!(code instanceof C.Macro)) && (this.can_transform(code))) {
        transformed = code.transform();
      }
      if ((transformed != null) && transformed !== code) {
        return this.transform(transformed);
      } else {
        return code;
      }
    };

    return Macro;

  })(C.Construct);

  define = function(defs) {
    var name, o_val, result, scope, sym, sym_def, sym_js_eval, val, var_stmt;
    sym_js_eval = new C.Symbol("js-eval");
    sym_def = new C.Symbol("def");
    defs = (function() {
      var _i, _len, _ref3, _results;
      _results = [];
      for (_i = 0, _len = defs.length; _i < _len; _i++) {
        _ref3 = defs[_i], name = _ref3[0], val = _ref3[1];
        sym = new C.Symbol(name);
        o_val = new C.Raw("" + val);
        _results.push(new C.List([sym_def, sym, o_val]));
      }
      return _results;
    })();
    result = new C.CodeFragment(defs);
    scope = C.current_scope();
    var_stmt = scope.var_stmt();
    return "" + var_stmt + (result._compile()) + ";";
  };

  compare_op = function(sym) {
    return "function () {\n  var last = arguments[0];\n  for (var i=1, len=arguments.length; i<len; i++) {\n    var current = arguments[i];\n    var result = last " + sym + " current;\n    if (!result) return result;\n    last = current;\n  }\n  return true;\n}";
  };

  binary_op = function(sym, _not) {
    if (_not == null) {
      _not = false;
    }
    return "function () {\n  var last = arguments[0];\n  for (var i=1, len=arguments.length; i<len; i++) {\n    if (" + (_not ? '!' : '') + "last) return last;\n    last = last " + sym + " arguments[i];\n  }\n  return last;\n}";
  };

  math_op = function(sym, explicit_convert) {
    if (explicit_convert == null) {
      explicit_convert = false;
    }
    return "function () {\n  var x = arguments[0];\n  for (var i=1, len=arguments.length; i<len; i++) {\n    x " + sym + "= " + (explicit_convert ? '+' : '') + "arguments[i];\n  }\n  return x;\n}";
  };

  push_unshift_op = function(method) {
    return "function (a) {\n    var args = __slice__.call(arguments, 1);\n    var new_a = a.slice();\n    new_a." + method + ".apply(new_a, args);\n    return new_a;\n}";
  };

  pop_shift_op = function(method) {
    return "function (a) {\n  var new_a = a.slice();\n  new_a." + method + "();\n  return new_a;\n}";
  };

  compile_runtime = function() {
    return define([
      ['+', math_op('+', true)], ['-', math_op('-')], ['*', math_op('*')], ['/', math_op('/')], [
        'mod', function(a, b) {
          return a % b;
        }
      ], ['**', "Math.pow"], ['=', compare_op('===')], ['not=', compare_op('!==')], ['<', compare_op('<')], ['>', compare_op('>')], ['<=', compare_op('<=')], ['>=', compare_op('>=')], ['or', binary_op('||')], ['and', binary_op('&&', true)], ['oppo-eval', 'oppo.eval'], ['__typeof__', 'lemur.core.to_type'], ['typeof', '__typeof__'], ['__slice__', 'Array.prototype.slice'], [
        'first', function(a) {
          return a[0];
        }
      ], [
        'second', function(a) {
          return a[1];
        }
      ], [
        'last', function(a) {
          return a[a.length - 1];
        }
      ], [
        'init', function(a) {
          return a.slice(0, a.length - 1);
        }
      ], [
        'rest', function(a) {
          return a.slice(1);
        }
      ], [
        'nth', function(a, n) {
          if (n < 0) {
            n += a.length;
          } else if (n === 0) {
            console.warn("nth treats collections as 1-based instead of 0 based. Don't try to access the 0th element.");
            return null;
          } else {
            n -= 1;
          }
          return a[n];
        }
      ], ['push', push_unshift_op("push")], ['push-right', 'push'], ['push-r', 'push'], ['push-left', push_unshift_op("unshift")], ['push-l', (new C.Symbol('push-left')).compile()], ['pop', pop_shift_op("pop")], ['pop-right', 'pop'], ['pop-r', 'pop'], ['pop-left', pop_shift_op("shift")], ['pop-l', (new C.Symbol('pop-left')).compile()], [
        'concat', function (x) {
      var args = __slice__.call(arguments, 1);
      return x.concat.apply(x, args);
    }
      ], [
        'sort', function(a, f) {
          var new_a;
          new_a = a.slice();
          if (f != null) {
            return new_a.sort(f);
          } else {
            return new_a.sort();
          }
        }
      ], [
        'map', function(f, o) {
          var k, result, t, v, x, _i, _len, _results;
          t = __typeof__(o);
          if (o.map != null) {
            return o.map(function(x) {
              return f(x);
            });
          } else if (t === "array" || o instanceof Array) {
            _results = [];
            for (_i = 0, _len = o.length; _i < _len; _i++) {
              x = o[_i];
              _results.push(f(x));
            }
            return _results;
          } else if (t === "object" || o instanceof Object) {
            result = {};
            for (k in o) {
              v = o[k];
              if (!o.hasOwnProperty(k)) {
                continue;
              }
              result[k] = f([k, v]);
            }
            return result;
          }
        }
      ], [
        'reduce', function(f, o) {
          var k, result, t, v, x, _i, _len;
          t = __typeof__(o);
          if (o.reduce != null) {
            return o.reduce(function(a, b) {
              return f(a, b);
            });
          } else if (t === "array" || o instanceof Array) {
            for (_i = 0, _len = o.length; _i < _len; _i++) {
              x = o[_i];
              if (!(typeof result !== "undefined" && result !== null)) {
                result = x;
                continue;
              }
              result = f(result, x);
            }
          } else if (t === "object" || o instanceof Object) {
            for (k in o) {
              v = o[k];
              if (!o.hasOwnProperty(k)) {
                continue;
              }
              if (!(result != null)) {
                result = v;
                continue;
              }
              result = f(result, v);
            }
          }
          return result;
        }
      ], [
        'reduce-right', function(f, o) {
          var result, t, x, _i, _len, _ref3;
          t = __typeof__(o);
          if (o.reduceRight != null) {
            return o.reduceRight(function(a, b) {
              return f(a, b);
            });
          } else if (t === "array" || o instanceof Array) {
            _ref3 = o.slice().reverse();
            for (_i = 0, _len = _ref3.length; _i < _len; _i++) {
              x = _ref3[_i];
              if (!(typeof result !== "undefined" && result !== null)) {
                result = x;
                continue;
              }
              result = f(result, x);
            }
            return result;
          } else if (t === "object" || o instanceof Object) {
            return reduce(f, o);
          }
        }
      ], ['reduce-r', (new C.Symbol('reduce-right')).compile()], [
        'filter', function(f, o) {
          var k, result, t, v, x, _i, _len;
          t = __typeof__(o);
          if (o.filter != null) {
            return o.filter(function(x) {
              return f(x);
            });
          } else if (t === "array" || o instanceof Array) {
            result = [];
            for (_i = 0, _len = o.length; _i < _len; _i++) {
              x = o[_i];
              if (f(x)) {
                result.push(x);
              }
            }
          } else if (t === "object" || o instanceof Object) {
            result = {};
            for (k in o) {
              v = o[k];
              if (!o.hasOwnProperty(k)) {
                continue;
              }
              if (f([k, v])) {
                result[k] = v;
              }
            }
          }
          return result;
        }
      ], [
        'keys', "Object.keys || " + function(o) {
          var k, _results;
          _results = [];
          for (k in o) {
            if (!o.hasOwnProperty(k)) {
              continue;
            }
            _results.push(k);
          }
          return _results;
        }
      ], [
        'values', function(o) {
          var k, t, _i, _len, _ref3, _results;
          t = __typeof__(o);
          if (t === "array" || o instanceof Array) {
            return o.slice();
          } else if (t === "object" || o instanceof Object) {
            _ref3 = keys(o);
            _results = [];
            for (_i = 0, _len = _ref3.length; _i < _len; _i++) {
              k = _ref3[_i];
              _results.push(o[k]);
            }
            return _results;
          }
        }
      ], [
        'str', function() {
          var arg, args;
          args = (function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = arguments.length; _i < _len; _i++) {
              arg = arguments[_i];
              if (typeof arg === "string") {
                _results.push(arg);
              } else if (arg.toString != null) {
                _results.push(arg.toString());
              } else {
                _results.push("" + arg);
              }
            }
            return _results;
          }).apply(this, arguments);
          return args.join('');
        }
      ], [
        'uppercase', function(s) {
          return s.toUpperCase();
        }
      ], [
        'lowercase', function(s) {
          return s.toLowerCase();
        }
      ], [
        'replace', function(s, re, rplc) {
          return s.replace(re, rplc);
        }
      ], [
        'match', function(s, re) {
          return s.match(re);
        }
      ], [
        're-test', function(re, s) {
          return re.test(s);
        }
      ]
    ]);
  };

  /*
  HELPERS
  */


  defmacro = function(name, fn, builtin) {
    var m, macro_args, s_name;
    if (builtin == null) {
      builtin = true;
    }
    s_name = new C.Symbol(name);
    macro_args = {
      name: s_name
    };
    if (builtin) {
      macro_args.invoke = fn;
    } else {
      macro_args.transform = fn;
    }
    m = new C.Macro(macro_args);
    m.builtin = builtin;
    m._compile();
    return m;
  };

  call_macro = function() {
    var args, name, ret, to_call;
    name = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    to_call = C.get_var_val(new C.Symbol(name));
    if (to_call.invoke != null) {
      return to_call.invoke.apply(to_call, args);
    } else {
      ret = to_call.transform.apply(to_call, args);
      return ret.compile();
    }
  };

  call_macro_transform = function() {
    var args, name, to_call;
    name = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    to_call = C.get_var_val(new C.Symbol(name));
    return to_call.transform.apply(to_call, args);
  };

  setup_built_in_macros = function() {
    /*
      JAVASCRIPT BUILTINS
    */

    var macro_do, macro_let, operator_macro;
    defmacro("js-eval", function(js_code) {
      if (js_code instanceof C.String) {
        return js_code.value;
      } else if (js_code instanceof C.Number) {
        return js_code._compile();
      } else if ((js_code instanceof C.Symbol) && js_code.quoted) {
        return js_code.name;
      } else {
        return "window.eval(" + (js_code._compile()) + ")";
      }
    });
    defmacro("if", function(cond, tbranch, fbranch) {
      var _if;
      return _if = new C.If({
        condition: cond,
        then: tbranch,
        _else: fbranch
      });
    }, false);
    defmacro("lambda", function() {
      var args, body, fn;
      args = arguments[0], body = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      return fn = new C.Lambda({
        args: args.value,
        body: body
      });
    }, false);
    defmacro("array", function() {
      var ary, items;
      items = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      return ary = new C.Array(items);
    }, false);
    defmacro("js-for", function() {
      var a, b, body, c, _for;
      a = arguments[0], b = arguments[1], c = arguments[2], body = 4 <= arguments.length ? __slice.call(arguments, 3) : [];
      return _for = new C.ForLoop({
        condition: [a, b, c],
        body: body
      });
    }, false);
    defmacro("foreach", function() {
      var body, coll, foreach;
      coll = arguments[0], body = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      return foreach = new C.ForEachLoop({
        collection: coll,
        body: body
      });
    }, false);
    operator_macro = function(name, className) {
      var macro_fn;
      macro_fn = function() {
        var Cls, args, postfix, prefix, results, x, y;
        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        Cls = C[className];
        prefix = Cls.prototype instanceof C.PrefixOperation;
        postfix = Cls.prototype instanceof C.PostfixOperation;
        results = (function() {
          var _results;
          _results = [];
          while (args.length) {
            x = args.shift();
            _results.push((prefix || postfix ? new Cls(x, x.yy) : (y = args.shift(), new Cls([x, y], x.yy))).compile());
          }
          return _results;
        })();
        return results.join(' ');
      };
      return defmacro(name, macro_fn);
    };
    operator_macro("subtract", "Subtract");
    operator_macro("add", "Add");
    operator_macro("multiply", "Multiply");
    operator_macro("divide", "Divide");
    operator_macro("modulo", "Mod");
    operator_macro("==", "Eq2");
    operator_macro("===", "Eq3");
    operator_macro("gt", "GT");
    operator_macro("lt", "LT");
    operator_macro("gte", "GTE");
    operator_macro("lte", "LTE");
    operator_macro("not===", "NotEq3");
    operator_macro("not==", "NotEq2");
    operator_macro("!", "Not");
    operator_macro("||", "Or");
    operator_macro("&&", "And");
    operator_macro("&", "BAnd");
    operator_macro("|", "BOr");
    operator_macro("^", "BXor");
    operator_macro("<<", "BLeftShift");
    operator_macro(">>", "BRightShift");
    operator_macro(">>>", "BZeroFillRightShift");
    operator_macro("~", "BNot");
    operator_macro("delete", "Delete");
    /*
      OPPO BUILTINS
    */

    defmacro("def", function() {
      var args, body, name, rest, scope, set_, to_define, value;
      to_define = arguments[0], rest = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if (!rest.length) {
        to_define.error("Def", "You must provide a value.");
      }
      scope = C.current_scope();
      if (to_define instanceof C.List) {
        name = to_define.value[0];
        args = to_define.value.slice(1);
        body = rest;
        value = new C.Lambda({
          name: name,
          args: args,
          body: body
        });
      } else if (to_define instanceof C.Symbol) {
        name = to_define;
        value = rest[0];
      } else {
        to_define.error("Def", "Invalid definition.");
      }
      name = new C.Var(name);
      return set_ = new C.Var.Set({
        _var: name,
        value: value
      });
    }, false);
    defmacro("call", function() {
      var args, callable, fcall, item;
      callable = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if (callable instanceof C.Symbol) {
        item = C.get_var_val(callable);
        if (item instanceof C.Macro) {
          if (item.invoke != null) {
            return new C.Raw(item.invoke.apply(item, args));
          } else {
            return item.transform.apply(item, args);
          }
        }
      }
      return fcall = new C.FunctionCall({
        fn: callable,
        args: args
      }, callable.yy);
    }, false);
    defmacro("defmacro", function() {
      var argnames, mac, name, template;
      argnames = arguments[0], template = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      name = argnames.items.shift();
      mac = new C.Macro({
        name: name,
        argnames: argnames,
        template: template
      });
      return new C.Raw(mac.compile());
    }, false);
    macro_let = defmacro("let", function() {
      var bindings, body, def_sym, i, item, new_bindings, new_body, sym, _i, _len, _ref3;
      bindings = arguments[0], body = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      def_sym = new C.Symbol('def');
      sym = null;
      new_bindings = [];
      _ref3 = bindings.value;
      for (i = _i = 0, _len = _ref3.length; _i < _len; i = ++_i) {
        item = _ref3[i];
        if (i % 2 === 0) {
          sym = item;
        } else {
          if (!(item != null)) {
            bindings.error("Must have even number of bindings.");
          }
          new_bindings.push(new types.List([def_sym, sym, item]));
        }
      }
      new_body = __slice.call(new_bindings).concat(__slice.call(body));
      return (new types.List([
        new types.Lambda({
          body: new_body
        })
      ])).compile();
    });
    macro_do = defmacro("do", function() {
      var arg, c_items;
      c_items = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = arguments.length; _i < _len; _i++) {
          arg = arguments[_i];
          _results.push(arg._compile());
        }
        return _results;
      }).apply(this, arguments);
      return "(" + (c_items.join(',\n')) + ")";
    });
    /*
      QUOTING
    */

    defmacro("quote", function(x) {
      x.quoted = true;
      return x;
    }, false);
    defmacro("quasiquote", function(x) {
      x.quasiquoted = true;
      return x;
    }, false);
    defmacro("unquote", function(x) {
      x.unquoted = true;
      return x;
    }, false);
    defmacro("unquote-splicing", function(x) {
      x.unquote_spliced = true;
      return x;
    }, false);
    /*
      ERRORS & VALIDATIONS
    */

    defmacro("raise", function(namespace, error) {
      var c_error, c_namespace;
      if (arguments.length === 1) {
        error = namespace;
        c_namespace = "\"Error\"";
      } else {
        c_namespace = namespace._compile();
      }
      c_error = error._compile();
      return "(function () {\n  throw new oppo.Error(" + c_namespace + ", " + c_error + ");\n})()";
    });
    return defmacro("assert", function(sexp) {
      var c_sexp, error, error_namespace, raise_call;
      c_sexp = sexp._compile();
      error_namespace = new types.String("Assertion-Error");
      error = new types.String(sexp.toString());
      raise_call = call_macro("raise", error_namespace, error);
      return "(" + c_sexp + " || " + raise_call + ")";
    });
  };

}).call(this);
